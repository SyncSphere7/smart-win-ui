<!-- Payment Modal -->
<div id="paymentModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="paymentModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content" style="border-radius: 12px; border: none;">
      <div class="modal-header" style="background: linear-gradient(135deg, #ee1e46 0%, #c71939 100%); color: white; border-radius: 12px 12px 0 0;">
        <h5 class="modal-title" id="paymentModalLabel">
          <i class="icon-credit-card"></i> Pay $100 Consultation Fee
        </h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-4">
        <!-- Payment Method Tabs -->
        <ul class="nav nav-tabs mb-4" id="paymentTabs" role="tablist">
          <li class="nav-item flex-fill">
            <a class="nav-link active text-center" id="crypto-tab" data-toggle="tab" href="#cryptoTab" role="tab">
              <i class="icon-bitcoin"></i><br>
              <strong>Crypto</strong>
            </a>
          </li>
          <li class="nav-item flex-fill">
            <a class="nav-link text-center" id="mobile-tab" data-toggle="tab" href="#mobileTab" role="tab">
              <i class="icon-phone"></i><br>
              <strong>Mobile Money</strong>
            </a>
          </li>
          <li class="nav-item flex-fill">
            <a class="nav-link text-center" id="card-tab" data-toggle="tab" href="#cardTab" role="tab">
              <i class="icon-credit-card"></i><br>
              <strong>Card Payment</strong>
            </a>
          </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="paymentTabContent">
          
          <!-- CRYPTO TAB -->
          <div class="tab-pane fade show active" id="cryptoTab" role="tabpanel">
            <div class="row">
              <div class="col-md-6 text-center mb-4">
                <h6 class="mb-3">Scan QR Code</h6>
                <img src="public/Bitcoin wallet.jpeg" alt="Bitcoin Wallet QR Code" class="img-fluid" style="max-width: 250px; border-radius: 8px; border: 2px solid #dee2e6;">
              </div>
              <div class="col-md-6">
                <h6 class="mb-3">Or Copy Address</h6>
                <div class="input-group mb-3">
                  <input type="text" class="form-control" id="walletAddress" value="Loading wallet address..." readonly style="font-size: 0.85rem;">
                  <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button" onclick="copyWalletAddress()">
                      <i class="icon-copy"></i> Copy
                    </button>
                  </div>
                </div>
                <div class="alert alert-info" role="alert" style="font-size: 0.9rem;">
                  <strong>Instructions:</strong>
                  <ol class="mb-0 pl-3 mt-2">
                    <li>Send exactly <strong>$100 USD in Bitcoin</strong> to the address above</li>
                    <li>Save your transaction ID</li>
                    <li>Fill out the form below to confirm payment</li>
                  </ol>
                </div>
              </div>
            </div>
            
            <hr class="my-4">
            
            <h6 class="mb-3">Payment Confirmation Form</h6>
            <form id="cryptoPaymentForm">
              <input type="hidden" name="paymentMethod" value="Crypto (Bitcoin)">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="cryptoName">Full Name *</label>
                  <input type="text" class="form-control" id="cryptoName" name="name" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="cryptoEmail">Email Address *</label>
                  <input type="email" class="form-control" id="cryptoEmail" name="email" required>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="cryptoPhone">Phone Number (WhatsApp/Telegram) *</label>
                  <input type="tel" class="form-control" id="cryptoPhone" name="phone" required placeholder="+1234567890">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="cryptoAmount">Amount Sent (USD) *</label>
                  <input type="number" class="form-control" id="cryptoAmount" name="amount" value="100" required>
                </div>
              </div>
              <div class="mb-3">
                <label for="cryptoTxId">Transaction ID (Hash) *</label>
                <input type="text" class="form-control" id="cryptoTxId" name="transactionId" required placeholder="Enter blockchain transaction ID">
                <small class="form-text text-muted">Find this in your wallet after sending Bitcoin</small>
              </div>
              <div class="mb-3">
                <label for="cryptoDateTime">Date & Time of Payment *</label>
                <input type="datetime-local" class="form-control" id="cryptoDateTime" name="paymentDateTime" required>
              </div>
              <button type="submit" class="btn btn-primary btn-block" style="background-color: #ee1e46; border: none;">
                Submit Payment Details
              </button>
            </form>
          </div>

          <!-- MOBILE MONEY TAB -->
          <div class="tab-pane fade" id="mobileTab" role="tabpanel">
            <div class="alert alert-warning" role="alert">
              <strong><i class="icon-info"></i> Mobile Money Payment Instructions</strong>
            </div>
            <div class="card mb-4">
              <div class="card-body">
                <h6>Send $100 USD via Mobile Money to:</h6>
                <div class="bg-light p-3 rounded mb-3">
                  <p class="mb-1"><strong>Service:</strong> M-Pesa / MTN Mobile Money / Airtel Money</p>
                  <p class="mb-1"><strong>Phone Number:</strong> <span id="mobileMoneyNumber">+254 XXX XXX XXX</span></p>
                  <p class="mb-0"><strong>Name:</strong> Smart-Win Official</p>
                </div>
                <small class="text-muted">Note: Exchange rate will be applied at time of payment</small>
              </div>
            </div>

            <h6 class="mb-3">Payment Confirmation Form</h6>
            <form id="mobilePaymentForm">
              <input type="hidden" name="paymentMethod" value="Mobile Money">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="mobileName">Full Name *</label>
                  <input type="text" class="form-control" id="mobileName" name="name" required>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="mobileEmail">Email Address *</label>
                  <input type="email" class="form-control" id="mobileEmail" name="email" required>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="mobilePhone">Your Phone Number *</label>
                  <input type="tel" class="form-control" id="mobilePhone" name="phone" required placeholder="+1234567890">
                </div>
                <div class="col-md-6 mb-3">
                  <label for="mobileAmount">Amount Sent (Local Currency) *</label>
                  <input type="number" class="form-control" id="mobileAmount" name="amount" required placeholder="e.g., 12500 KES">
                </div>
              </div>
              <div class="mb-3">
                <label for="mobileTxId">Transaction Reference/Code *</label>
                <input type="text" class="form-control" id="mobileTxId" name="transactionId" required placeholder="Enter M-Pesa/MTN reference code">
              </div>
              <div class="mb-3">
                <label for="mobileDateTime">Date & Time of Payment *</label>
                <input type="datetime-local" class="form-control" id="mobileDateTime" name="paymentDateTime" required>
              </div>
              <div class="mb-3">
                <label for="mobileService">Mobile Money Service *</label>
                <select class="form-control" id="mobileService" name="service" required>
                  <option value="">Select Service</option>
                  <option value="M-Pesa">M-Pesa</option>
                  <option value="MTN Mobile Money">MTN Mobile Money</option>
                  <option value="Airtel Money">Airtel Money</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <button type="submit" class="btn btn-primary btn-block" style="background-color: #ee1e46; border: none;">
                Submit Payment Details
              </button>
            </form>
          </div>

          <!-- CARD PAYMENT TAB -->
          <div class="tab-pane fade" id="cardTab" role="tabpanel">
            <div class="text-center py-5">
              <i class="icon-credit-card" style="font-size: 4rem; color: #dee2e6;"></i>
              <h5 class="mt-3">Card Payment Integration Coming Soon</h5>
              <p class="text-muted">We're working on integrating Visa and Mastercard payments.</p>
              <p class="text-muted">For now, please use <strong>Crypto</strong> or <strong>Mobile Money</strong> payment options.</p>
              <div class="mt-4">
                <button class="btn btn-outline-primary" data-toggle="tab" href="#cryptoTab">
                  <i class="icon-bitcoin"></i> Pay with Crypto
                </button>
                <button class="btn btn-outline-primary ml-2" data-toggle="tab" href="#mobileTab">
                  <i class="icon-phone"></i> Pay with Mobile Money
                </button>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content text-center">
      <div class="modal-body p-5">
        <i class="icon-check-circle" style="font-size: 4rem; color: #28a745;"></i>
        <h4 class="mt-3">Payment Details Submitted!</h4>
        <p class="text-muted">Thank you! We've received your payment details and will verify your transaction shortly.</p>
        <p class="text-muted">You'll receive a confirmation email at <strong id="confirmEmail"></strong> within 24 hours.</p>
        <button type="button" class="btn btn-primary mt-3" data-dismiss="modal" style="background-color: #ee1e46; border: none;">
          Close
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Copy wallet address function
function copyWalletAddress() {
  const walletInput = document.getElementById('walletAddress');
  walletInput.select();
  document.execCommand('copy');
  
  // Show feedback
  const btn = event.target.closest('button');
  const originalText = btn.innerHTML;
  btn.innerHTML = '<i class="icon-check"></i> Copied!';
  btn.classList.remove('btn-outline-secondary');
  btn.classList.add('btn-success');
  
  setTimeout(() => {
    btn.innerHTML = originalText;
    btn.classList.remove('btn-success');
    btn.classList.add('btn-outline-secondary');
  }, 2000);
}

// Handle Crypto form submission
document.getElementById('cryptoPaymentForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  await submitPaymentForm(e.target);
});

// Handle Mobile Money form submission
document.getElementById('mobilePaymentForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  await submitPaymentForm(e.target);
});

// Submit payment form
async function submitPaymentForm(form) {
  const submitBtn = form.querySelector('button[type="submit"]');
  const originalBtnText = submitBtn.innerHTML;
  submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm mr-2"></span>Submitting...';
  submitBtn.disabled = true;

  try {
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    
    const response = await fetch('/api/send-payment', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });

    if (response.ok) {
      // Show success modal
      document.getElementById('confirmEmail').textContent = data.email;
      $('#paymentModal').modal('hide');
      $('#successModal').modal('show');
      form.reset();
    } else {
      throw new Error('Failed to submit payment details');
    }
  } catch (error) {
    alert('Error submitting payment details. Please try again or contact support at info@smartwinofficial.co.uk');
    console.error('Payment submission error:', error);
  } finally {
    submitBtn.innerHTML = originalBtnText;
    submitBtn.disabled = false;
  }
}

// Initialize datetime fields with current datetime
document.addEventListener('DOMContentLoaded', function() {
  const now = new Date();
  const localDateTime = now.toISOString().slice(0, 16);
  document.getElementById('cryptoDateTime').value = localDateTime;
  document.getElementById('mobileDateTime').value = localDateTime;
});
</script>

<style>
.nav-tabs .nav-link {
  color: #6c757d;
  border: none;
  padding: 1rem;
}

.nav-tabs .nav-link.active {
  color: #ee1e46;
  border-bottom: 3px solid #ee1e46;
  font-weight: bold;
}

.nav-tabs .nav-link:hover {
  color: #ee1e46;
  border-color: transparent;
}

#paymentModal .modal-content {
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}
</style>
